---
description: 四旋翼无人机L1自适应控制律推导
date: '2026-01-27'
author: 'pxx'
categories:
  - Optimal Control
published: true
---

# 基于推力–力矩输入的 L1 自适应控制律推导（NED 坐标系）

本文系统推导了在 **NED（North–East–Down）坐标系**下、以 **总推力 $f$ 与三轴力矩 $\boldsymbol{\tau}$** 为控制输入的四旋翼 L1 自适应控制律。推导采用 **piecewise-constant adaptation law**，并严格区分 **matched** 与 **unmatched uncertainties**。文中从动力学建模、状态预测器（observer）构造、误差系统解析解出发，给出自适应律的闭式表达形式，最终得到适用于推力–力矩输入形式的 L1 自适应控制框架。该推导可直接用于与 NMPC、几何控制或平坦性控制的级联实现。

## 1. 坐标系与符号约定

### 1.1 坐标系定义

- **惯性坐标系**：$\mathcal{F}_n=\{n,e,d\}$，采用 **NED** 约定，重力方向为 $+d$
- **机体坐标系**：$\mathcal{F}_b=\{x_b,y_b,z_b\}$，采用 **FRD**（Forward–Right–Down）约定
- 旋转矩阵 $\mathbf{R}_{nb}\in SO(3)$ 将机体系向量映射到惯性系

重力向量在 NED 系下表示为
$$
\mathbf{g}^n = \begin{bmatrix}0\\0\\g\end{bmatrix},\quad g\approx 9.81\,\text{m/s}^2
$$

### 1.2 控制输入

系统控制输入定义为
$$
\mathbf{u}=\begin{bmatrix}f\\ \boldsymbol{\tau}\end{bmatrix} \in \mathbb{R}^4
$$
其中
- $f$：总推力标量
- $\boldsymbol{\tau}=[\tau_x,\tau_y,\tau_z]^T$：机体系三轴力矩

推力在机体系中沿 $-z_b$ 方向，在惯性系中方向为 $-\mathbf{b}_3$，其中 $\mathbf{b}_3=\mathbf{R}_{nb}\mathbf{e}_3$。

## 2. 动力学模型

### 2.1 状态变量

选取 L1 自适应控制常用的 reduced state：
$$
\mathbf{z}=\begin{bmatrix}\mathbf{v}^n\\ \boldsymbol{\omega}^b\end{bmatrix}\in\mathbb{R}^6
$$
其中 $\mathbf{v}^n$ 为质心线速度（NED），$\boldsymbol{\omega}^b$ 为机体系角速度。

### 2.2 名义动力学

四旋翼的名义动力学写为
$$
\dot{\mathbf{v}}^n = \mathbf{g}^n - \frac{f}{m}\mathbf{b}_3 + \mathbf{d}_v(\mathbf{v})
$$
$$
\dot{\boldsymbol{\omega}}^b = \mathbf{J}^{-1}\big(\boldsymbol{\tau}-\boldsymbol{\omega}^b\times(\mathbf{J}\boldsymbol{\omega}^b)\big)
$$
其中 $m$ 为质量，$\mathbf{J}$ 为转动惯量矩阵，$\mathbf{d}_v$ 表示名义模型中可能包含的阻力项。

将名义部分合并为
$$
\mathbf{f}_0(\cdot)=
\begin{bmatrix}
\mathbf{g}^n - \dfrac{f_{\text{MPC}}}{m}\mathbf{b}_3 + \mathbf{d}_v\\
\mathbf{J}^{-1}\big(\boldsymbol{\tau}_{\text{MPC}}-\boldsymbol{\omega}\times(\mathbf{J}\boldsymbol{\omega})\big)
\end{bmatrix}
$$

## 3. 不确定性建模

### 3.1 Matched Uncertainty

Matched uncertainty 定义为可通过输入通道直接补偿的不确定性：
$$
\boldsymbol{\sigma}_m=
\begin{bmatrix}
\sigma_f\\ \sigma_{\tau x}\\ \sigma_{\tau y}\\ \sigma_{\tau z}
\end{bmatrix}\in\mathbb{R}^4
$$

### 3.2 Unmatched Uncertainty

由于推力仅沿 $-\mathbf{b}_3$ 方向，横向平面内的加速度扰动不可直接补偿，定义
$$
\boldsymbol{\sigma}_{um}=\begin{bmatrix}\sigma_{a1}\\ \sigma_{a2}\end{bmatrix}\in\mathbb{R}^2
$$
对应机体系 $\mathbf{b}_1,\mathbf{b}_2$ 方向的等效加速度扰动。

## 4. 标准 L1 形式

系统可写为
$$
\dot{\mathbf{z}}=\mathbf{f}_0+\mathbf{g}(\mathbf{u}_{L1}+\boldsymbol{\sigma}_m)+\mathbf{g}_\perp\boldsymbol{\sigma}_{um}
$$

其中
$$
\mathbf{g}=
\begin{bmatrix}
-\dfrac{1}{m}\mathbf{b}_3 & \mathbf{0}_{3\times3}\\
\mathbf{0}_{3\times1} & \mathbf{J}^{-1}
\end{bmatrix},\quad
\mathbf{g}_\perp=
\begin{bmatrix}
\dfrac{1}{m}\mathbf{b}_1 & \dfrac{1}{m}\mathbf{b}_2\\
\mathbf{0}_{3\times2}
\end{bmatrix}
$$

## 5. L1 状态预测器

定义预测器
$$
\dot{\hat{\mathbf{z}}}=\mathbf{f}_0+\mathbf{g}(\mathbf{u}_{L1}+\hat{\boldsymbol{\sigma}}_m)+\mathbf{g}_\perp\hat{\boldsymbol{\sigma}}_{um}+\mathbf{A}_s\tilde{\mathbf{z}}
$$
其中
$$
\tilde{\mathbf{z}}=\hat{\mathbf{z}}-\mathbf{z}
$$
矩阵 $\mathbf{A}_s$ 为 Hurwitz 矩阵，用于注入稳定误差动力学。

## 6. 误差系统与解析解

误差动力学为
$$
\dot{\tilde{\mathbf{z}}}=\mathbf{A}_s\tilde{\mathbf{z}}+\mathbf{G}\tilde{\boldsymbol{\sigma}}
$$
其中
$$
\mathbf{G}=[\mathbf{g}\;\mathbf{g}_\perp],\quad
\tilde{\boldsymbol{\sigma}}=
\begin{bmatrix}
\hat{\boldsymbol{\sigma}}_m-\boldsymbol{\sigma}_m\\
\hat{\boldsymbol{\sigma}}_{um}-\boldsymbol{\sigma}_{um}
\end{bmatrix}
$$

在采样周期 $T_s$ 内假设 $\tilde{\boldsymbol{\sigma}}$ 常值，则有解析解
$$
\tilde{\mathbf{z}}_{k+1}=e^{\mathbf{A}_sT_s}\tilde{\mathbf{z}}_k+\mathbf{\Phi}\mathbf{G}\tilde{\boldsymbol{\sigma}}_k
$$
其中
$$
\mathbf{\Phi}=\mathbf{A}_s^{-1}(e^{\mathbf{A}_sT_s}-\mathbf{I})
$$
并定义
$$
\boldsymbol{\mu}_k=e^{\mathbf{A}_sT_s}\tilde{\mathbf{z}}_k
$$

## 7. Piecewise-Constant 自适应律

令下一采样时刻误差为零：
$$
\tilde{\mathbf{z}}_{k+1}=0
$$
得到
$$
\mathbf{\Phi}\mathbf{G}\tilde{\boldsymbol{\sigma}}_k=-\boldsymbol{\mu}_k
$$
从而得到自适应律
$$
\boxed{
\begin{bmatrix}
\hat{\boldsymbol{\sigma}}_{m,k}\\
\hat{\boldsymbol{\sigma}}_{um,k}
\end{bmatrix}
=-\mathbf{G}^{-1}\mathbf{\Phi}^{-1}\boldsymbol{\mu}_k
}
$$
实际实现中应采用 QR 或 SVD 方法求解线性方程以保证数值稳定性。

## 8. L1 控制律（滤波注入）

为避免高频注入，L1 控制输入采用严格真有理低通滤波：
$$
\mathbf{u}_{L1}(s)=-\mathbf{C}(s)\hat{\boldsymbol{\sigma}}_m(s)
$$
常用一阶离散实现为
$$
\mathbf{u}_{L1,k}=\alpha\mathbf{u}_{L1,k-1}-(1-\alpha)\hat{\boldsymbol{\sigma}}_{m,k},\quad
\alpha=e^{-\omega_c T_s}
$$

最终控制指令为
$$
\begin{bmatrix}f\\ \boldsymbol{\tau}\end{bmatrix}_{\text{cmd}}=
\begin{bmatrix}f\\ \boldsymbol{\tau}\end{bmatrix}_{\text{MPC}}+\mathbf{u}_{L1}
$$

