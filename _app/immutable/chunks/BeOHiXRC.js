const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BYxc2Ksz.js","./BCuXwNj5.js","./B3pWoj6v.js","./CYgJF_JY.js","./BNJoE8qS.js"])))=>i.map(i=>d[i]);
import{l as h,s as p,c as f,b as m}from"./ScjmPDhD.js";import{s as b}from"./C-r6bpSB.js";import{f as _,w as y}from"./BCuXwNj5.js";import{I as w}from"./CjsJ53PR.js";import{s as S}from"./BYxc2Ksz.js";import{_ as $}from"./C1FmrZbK.js";function R(e,t){const o=h(t,["children","$$slots","$$events","$$legacy"]);w(e,p({name:"lock"},()=>o,{iconNode:[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4"}]],children:(i,d)=>{var s=f(),a=_(s);b(a,t,"default",{}),m(i,s)},$$slots:{default:!0}}))}function V(e,t){const o=h(t,["children","$$slots","$$events","$$legacy"]);w(e,p({name:"x"},()=>o,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(i,d)=>{var s=f(),a=_(s);b(a,t,"default",{}),m(i,s)},$$slots:{default:!0}}))}const v=()=>{const e=S;return{page:{subscribe:e.page.subscribe},navigating:{subscribe:e.navigating.subscribe},updated:e.updated}},X={subscribe(e){return v().page.subscribe(e)}},A="sha256:936a185caaa266bb9cbe981e9e05cb78cd732b0b3280eb944412bb6f8f8f07af",u="preview-auth",l={isLoggedIn:!1,displayName:"",tokenHash:"",loggedAt:0},H=()=>{try{const e=localStorage.getItem(u);if(!e)return l;const t=JSON.parse(e);return{isLoggedIn:!!(t!=null&&t.isLoggedIn),displayName:(t==null?void 0:t.displayName)||"",tokenHash:(t==null?void 0:t.tokenHash)||"",loggedAt:Number(t==null?void 0:t.loggedAt)||0}}catch(e){return console.warn("[preview-auth] Failed to parse stored state",e),l}},E=e=>{localStorage.setItem(u,JSON.stringify(e))},I=e=>Array.from(new Uint8Array(e)).map(t=>t.toString(16).padStart(2,"0")).join(""),N=async e=>{if(!e)return"";if(typeof crypto<"u"&&crypto.subtle){const o=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",o);return I(r)}try{const{createHash:t}=await $(async()=>{const{createHash:o}=await import("./BYxc2Ksz.js").then(r=>r._);return{createHash:o}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);return t("sha256").update(e).digest("hex")}catch(t){return console.warn("[preview-auth] Failed to hash token",t),""}};let c=A.trim().toLowerCase();c.startsWith("sha256:")&&(c=c.slice(7));const n=c||null;n||console.warn("[preview-auth] Missing PUBLIC_PREVIEW_TOKEN_HASH. Login will always fail.");const L=e=>Date.now()-e>36e5;function P(){const{subscribe:e,set:t}=y(l),o=()=>{t(l),localStorage.removeItem(u)},r=()=>{if(!n)return o();const s=H();s.isLoggedIn&&s.tokenHash===n&&!L(s.loggedAt)?t(s):o()},i=async s=>{if(!n)return!1;const a=s.trim();if(!a||await N(a)!==n)return!1;const g={isLoggedIn:!0,displayName:"Preview",tokenHash:n,loggedAt:Date.now()};return t(g),E(g),!0},d=()=>{o()};return r(),{subscribe:e,login:i,logout:d}}const B=P();export{R as L,V as X,B as a,X as p};
